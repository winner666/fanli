<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>活动列表</title>
    <meta name="description" content="这是一个 index 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="icon" type="image/png" href="../../assets/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="../../assets/i/app-icon72x72@2x.png">

    <meta name="apple-mobile-web-app-title" content="Amaze UI" />
    <script src="../../assets/js/echarts.min.js"></script>
    <link rel="stylesheet" href="../../assets/css/amazeui.min.css" />
    <link rel="stylesheet" href="../../assets/css/amazeui.datatables.min.css" />
    <link rel="stylesheet" href="../../assets/css/amazeui.datetimepicker.css"/>
    <link rel="stylesheet" href="../../assets/css/app.css">
    <link rel="stylesheet" href="../../css/page.css">
    <link rel="stylesheet" href="../../css/common.css">
    <script src="../../assets/js/jquery.min.js"></script>
    <style>
        .am-selected {
            width:25%;
            font-size:13px;}
        .btn button{margin-right:6rem;}
    </style>
</head>
<body data-type="widgets">
<script src="../../assets/js/theme.js"></script>
<div class="am-g tpl-g">
    <!-- 头部 -->
    <header>
        <!-- logo -->
        <div class="am-fl tpl-header-logo">
            <a href="javascript:;"><img src="../../assets/img/logo.png" alt=""></a>
        </div>
        <!-- 右侧内容 -->
        <div class="tpl-header-fluid">
            <!-- 侧边切换 -->
            <div class="am-fl tpl-header-switch-button am-icon-list">
                    <span>

                </span>
            </div>

            <!-- 其它功能-->
            <div class="am-fr tpl-header-navbar">
                <ul>
                    <!-- 欢迎语 -->
                    <li class="am-text-sm tpl-header-navbar-welcome">
                        <a href="../set/pass.html">修改密码</a>
                    </li>
                    <!-- 退出 -->
                    <li class="am-text-sm">
                        <a href="javascript:;" class="back">
                            <span class="am-icon-sign-out"></span> 退出
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </header>
    <!-- 风格切换 -->
    <div class="tpl-skiner">
        <div class="tpl-skiner-toggle am-icon-cog">
        </div>
        <div class="tpl-skiner-content">
            <div class="tpl-skiner-content-title">
                选择主题
            </div>
            <div class="tpl-skiner-content-bar">
                <span class="skiner-color skiner-white" data-color="theme-white"></span>
                <span class="skiner-color skiner-black" data-color="theme-black"></span>
            </div>
        </div>
    </div>
 <!-- 侧边导航栏 -->
			<div class="left-sidebar">

				<!-- 菜单 -->
				<ul class="sidebar-nav">

					<!--<li class="sidebar-nav-link">
						<a href="../index/index.html">
							<i class="am-icon-home sidebar-nav-link-logo"></i>首页
						</a>
					</li>-->

					<li class="sidebar-nav-link">
						<a href="javascript:;" class="sidebar-nav-sub-title">
							<i class="am-icon-table sidebar-nav-link-logo"></i>商户管理
							<span class="am-icon-chevron-down am-fr am-margin-right-sm sidebar-nav-sub-ico"></span>
						</a>
						<ul class="sidebar-nav sidebar-nav-sub">
							<li class="sidebar-nav-link">
								<a href="../index/userShopType.html">
									<span class="am-icon-angle-right sidebar-nav-link-logo"></span> 商户分类
								</a>
							</li>

							<li class="sidebar-nav-link">
								<a href="../index/index.html">
									<span class="am-icon-angle-right sidebar-nav-link-logo"></span>商户列表
								</a>
							</li>
						</ul>
					</li>
					<li class="sidebar-nav-link">
						<a href="../goods/goodsList.html">
							<i class="am-icon-calendar sidebar-nav-link-logo"></i>商品列表
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="../user/userList.html">
							<i class="am-icon-calendar sidebar-nav-link-logo"></i>用户管理
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="../order/orderList.html">
							<i class="am-icon-calendar sidebar-nav-link-logo"></i>订单管理
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="../comment/commentList.html">
							<i class="am-icon-calendar sidebar-nav-link-logo"></i>评价管理
						</a>
					</li>
					<li class="sidebar-nav-link">
						<a href="javascript:;" class="sidebar-nav-sub-title">
							<i class="am-icon-table sidebar-nav-link-logo"></i>资讯管理
							<span class="am-icon-chevron-down am-fr am-margin-right-sm sidebar-nav-sub-ico"></span>
						</a>
						<ul class="sidebar-nav sidebar-nav-sub">
							<li class="sidebar-nav-link">
								<a href="../information/sensitive.html">
									<span class="am-icon-angle-right sidebar-nav-link-logo"></span>设置敏感词
								</a>
							</li>
							<li class="sidebar-nav-link">
								<a href="../information/type.html">
									<span class="am-icon-angle-right sidebar-nav-link-logo"></span>资讯分类
								</a>
							</li>	
							<li class="sidebar-nav-link">
								<a href="../information/informationList.html">
									<span class="am-icon-angle-right sidebar-nav-link-logo"></span>资讯列表
								</a>
							</li>
						</ul>
					</li>
					<li class="sidebar-nav-link">
						<a href="javascript:;" class="sidebar-nav-sub-title">
							<i class="am-icon-table sidebar-nav-link-logo"></i>财务管理
							<span class="am-icon-chevron-down am-fr am-margin-right-sm sidebar-nav-sub-ico"></span>
						</a>
						<ul class="sidebar-nav sidebar-nav-sub">
							<li class="sidebar-nav-link">
								<a href="../finance/recharge.html">
									<span class="am-icon-angle-right sidebar-nav-link-logo"></span>充值列表
								</a>
							</li>

							<li class="sidebar-nav-link">
								<a href="../finance/withdrawals.html">
									<span class="am-icon-angle-right sidebar-nav-link-logo"></span>提现列表
								</a>
							</li>
						</ul>
					</li>
					<li class="sidebar-nav-link">
						<a href="../active/active.html">
							<i class="am-icon-wpforms sidebar-nav-link-logo"></i>活动管理
						</a>
					</li>
					<!--<li class="sidebar-nav-link">
						<a href="../agent/agent.html">
							<i class="am-icon-bar-chart sidebar-nav-link-logo"></i>代理管理
						</a>
					</li>

					<li class="sidebar-nav-link">
						<a href="javascript:;" class="sidebar-nav-sub-title">
							<i class="am-icon-table sidebar-nav-link-logo"></i>系统管理
							<span class="am-icon-chevron-down am-fr am-margin-right-sm sidebar-nav-sub-ico"></span>
						</a>
						<ul class="sidebar-nav sidebar-nav-sub">
							<li class="sidebar-nav-link">
								<a href="table-list.html">
									<span class="am-icon-angle-right sidebar-nav-link-logo"></span> 文字列表
								</a>
							</li>

							<li class="sidebar-nav-link">
								<a href="../set/pass.html">
									<span class="am-icon-angle-right sidebar-nav-link-logo"></span>修改密码
								</a>
							</li>
						</ul>
					</li>-->
				</ul>
			</div>
			<!-- 内容区域 -->
    <div class="tpl-content-wrapper">
        <div style="margin:1.5rem 0 0 1.5rem;">
            <div class="row-content am-cf">
                <div class="row">
                    <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
                        <div class="widget am-cf">
                            <div class="widget-head am-cf">
                                <div class="widget-title am-fl">活动列表</div>
                            </div>
                            <div class="widget-body  am-fr">
                                <form class="am-form tpl-form-border-form tpl-form-border-br am-form-inline">
                                    <div class="am-g">
                                        <div class="am-u-sm-4 am-u-md-4 ">
                                            <label for="shopName" class="am-fl">店铺名称</label>
                                            <div  class="am-u-sm-8 am-u-md-8 ">
                                                <input type="text" class="am-form-field am-fl input" id="shopName">
                                            </div>
                                        </div>


                                        <div class="am-u-sm-4 am-u-md-4 ">

                                        </div>

                                        <div class="am-u-sm-4 am-u-md-4 ">
                                            <button type="button" class="am-btn am-btn-secondary am-btn-xs" onclick="orderList(1,-1)">搜索</button>
                                        </div>
                                    </div>
                                    <div class="am-u-sm-12" style="margin-top: 1.5rem;">
                                        <table width="100%" class="am-table am-table-compact am-table-striped tpl-table-black " id="example-r">
                                            <thead>
                                            <tr>
                                                <th>店铺名称</th>
                                                <th>活动内容</th>
                                                <th>时间</th>
                                                <th>操作</th>
                                            </tr>
                                            </thead>
                                            <tbody class="list">

                                            <!-- more data -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <!--分页-->
                                    <div class="am-u-lg-12 am-cf">
                                        <div class="am-fr isPage">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--列表end-->
        </div>
    </div>
</div>
</div>
<script src="../../assets/js/amazeui.min.js"></script>
<script src="../../assets/js/amazeui.datatables.min.js"></script>
<script src="../../assets/js/dataTables.responsive.min.js"></script>
<script src="../../js/jquery.page.js"></script>
<script src="../../assets/js/app.js"></script>
<script src="../../js/url.js"></script>
<script src="../../js/common.js"></script>
<script>
    var pageSize =10; //每页显示数量
    var pageNum = 1; //当前页数
    var total = 0; //总页数
    var bTestTag = true;
    orderList(1)

    function orderList(pageNum, isInit) {
        var shopName = $('#shopName').val(); //商铺名称


        if(shopName == '') {
            shopName = null;
        }
        $.ajax({
            type: "post",
            url: http + "activity/getActivity",
            async: true,
            contentType: "application/json;charset=utf-8",
            dataType: 'json',
            data: JSON.stringify({
                "shopName": shopName,
                "page": pageNum,
                "size": pageSize
            }),
            success: function(data) {
                console.log(data);
                if(data.code == 200) {
                    total = Math.ceil(data.total / pageSize);
                    if(bTestTag || isInit == -1) {
                        //console.log("为什么没进来？")
                        bTestTag = false
                        isInit = !isInit
                        page()
                    } else {
                        //console.log("执行下一页")
                    }
                    var list = data.obj;
                    if(list.length != 0) {
                        var html = '';

                        for(var i = 0; i<list.length; i++) {

                            var newDate = new Date();
                            var createTime = list[i].createTime
                            newDate.setTime(createTime);
                            time = newDate.format('yyyy-MM-dd hh:mm:ss');
                            html+='<tr>'
                            html+='<td class="am-text-middle">'+list[i].shopName+'</td>'
                            html+='<td class="am-text-middle">'+list[i].content+'</td>'
                            html+='<td class="am-text-middle">'+time+'</td>'
                            html+='<td class="am-text-middle">'
                            html+='<div class="tpl-table-black-operation">'
                            html+='<a href="javascript:;" class="tpl-table-black-operation-del cancle" activityId="'+list[i].activityId+'">'
                            html+='<i class="am-icon-trash"></i>删除'
                            html+='</a>'
                            html+='</div>'
                            html+='</td>'
                            html+='</tr>'
                        }
                        $('.list').html(html)
                        $('.cancle').click(function(){
                            var  activityId=$(this).attr('activityId');
                            $.ajax({
                                type: "post",
                                url: http + "activity/delActivity",
                                async: true,
                                contentType: "application/json;charset=utf-8",
                                dataType: 'json',
                                data: JSON.stringify({
                                    "activityId": activityId,
                                    "isDel":1,
                                }),
                                success: function(data) {
                                    console.log(data)
                                    if(data.code==200){
                                        alert('删除成功')
                                        orderList(pageNum)
                                    }
                                }
                            })
                        })
                    } else {
                        $('.list').html('暂无数据')
                    }

                } else {
                    $('.list').html('网络错误')
                }
            },
            error: function(data) {
                console.log(data)
            }
        });
    }

    //点击查看
    $('.look').click(function() {

        var orderId = $(this).attr('orderId');
        sessionStorage.setItem('orderId', orderId)
    })
    //分页
    function page() { //这段代码不能放在函数内执行，会引起下一页出问题
        $(".tcdPageCode").remove();
        $(".isPage").append("<div class='tcdPageCode'></div>");
        $(".tcdPageCode").createPage({
            pageCount: total,
            current: 1,
            backFn: function(p){
                pageNum=p
                orderList(p)
            }
        });
    }
</script>
</body>
</html>